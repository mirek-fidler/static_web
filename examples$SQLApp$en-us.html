<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="en-us">
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="U++ HTML Package">
<TITLE>Demos / SQLApp :: U++</TITLE>
<STYLE TYPE="text/css"><!--
.A{margin:0px 0px 0px 0px;text-indent:0px;text-align:left;color:#000000;font-family:sans-serif;font-size:10pt;font-weight:normal;font-style:normal;}
.B{font-size:12pt;}
.C{margin:0px 0px 0px 0px;text-indent:0px;text-align:left;color:#000000;font-family:serif;font-size:24pt;font-weight:bold;font-style:normal;}
.D{margin:0px 0px 0px 0px;text-indent:0px;text-align:left;color:#000000;font-family:sans-serif;font-size:12pt;font-weight:normal;font-style:normal;}
.E{margin:0px 0px 0px 0px;text-indent:0px;text-align:center;color:#000000;font-family:sans-serif;font-size:12pt;font-weight:normal;font-style:normal;}
.F{margin:0px 0px 0px 0px;text-indent:0px;text-align:left;color:#000000;font-family:sans-serif;font-size:16pt;font-weight:bold;font-style:normal;}
.G{margin:0px 0px 0px 0px;text-indent:0px;text-align:left;color:#000000;font-family:monospace;font-size:9pt;font-weight:normal;font-style:normal;}
.H{color:#0000ff;}
.I{margin:0px 0px 0px 0px;text-indent:0px;text-align:left;color:#0000ff;font-family:monospace;font-size:9pt;font-weight:normal;font-style:normal;}
.J{color:#000000;}
a.l1         { text-decoration:none; font-size: 8pt; font-family: sans-serif; font-weight: normal; }
a.l1:link    { color:#000000; }
a.l1:visited { color:#000080; }
a.l1:hover   { color:#9933CC; }
a.l1:active  { color:#000000; }
a.l2         { text-decoration:none; font-size: 12pt; font-family: sans-serif; font-variant: small-caps; }
a.l2:link    { color:#0066FF; }
a.l2:visited { color:#FF6600; }
a.l2:hover   { color:#BC0624; }
a.l2:active  { color:#BC0024; }

-->
</STYLE>
<META NAME="keywords" CONTENT="framework, toolkit, widget, c++, visual, studio, dev-cpp, builder, ide, class, component,wxwidgets, qt, rapid, application, development, rad, mfc, linux, macos, gui, sdl, directx, desktop"><META name="robots" content="index,follow">
<LINK rel="alternate" type="application/rss+xml" title="SVN changes" href="svnchanges.xml">
<LINK rel="shortcut icon" type="image/png" href="favicon.png">
</HEAD><BODY BGCOLOR="#D2D9D2" ALINK="#800000" LINK="#000000" VLINK="#000080"><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%"><TR><TD COLSPAN="3"><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%" BGCOLOR="#FFFFFF" style="border: 1px solid #6E89AE;padding-left: 10px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;"><TR><TD><A HREF="index.html"><IMG SRC="0i.png" ALT="" BORDER="0"></A>
</TD>
<TD ALIGN="RIGHT" VALIGN="BOTTOM" STYLE="padding-bottom: 5px; background-image: url('1i.png')"><span style="font-size: 14pt; font-family: sans-serif;"><script type="text/javascript"><!--
google_ad_client = "pub-1082147624384270";
google_ad_width = 468;
google_ad_height = 60;
google_ad_format = "468x60_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "008000";
//--></script>
<script type="text/javascript"
  src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
&nbsp;&nbsp;</span>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%"><TR><TD COLSPAN="3" BGCOLOR="#D2D9D2" HEIGHT="6"></TD>
</TR>
<TR><TD VALIGN="TOP" ALIGN="CENTER"><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="160"><TR><TD ALIGN="CENTER"><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%" BGCOLOR="#FFFFFF" style="border-style: solid; border-width: 1px; border-color: #6E89AE;padding: 0px"><TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px;"><A HREF="www$uppweb$overview$en-us.html" CLASS="l1">Overview</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$examples$en-us.html" CLASS="l1">Examples</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$ss$en-us.html" CLASS="l1">Screenshots</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$comparison$en-us.html" CLASS="l1">Comparisons</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$apps$en-us.html" CLASS="l1">Applications</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$download$en-us.html" CLASS="l1">Download</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$documentation$en-us.html" CLASS="l1">Documentation</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$Tutorials$en-us.html" CLASS="l1">Tutorials</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="app$ide$UppHub$en-us.html" CLASS="l1">UppHub</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$Roadmap$en-us.html" CLASS="l1">Status & Roadmap</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$FAQ$en-us.html" CLASS="l1">FAQ</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="app$ide$About$en-us.html" CLASS="l1">Authors & License</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="https://www.ultimatepp.org/forums" CLASS="l1">Forums</A>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:12px; padding-right:0px; padding-top:6px; padding-bottom:6px; border-top: 1px solid #6E89AE;"><A HREF="www$uppweb$Funding$en-us.html" CLASS="l1">Funding U++</A>
</TD>
</TR>
</TABLE>
<TABLE BORDER="0" WIDTH="100%"><TR><TD></TD>
</TR>
</TABLE>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%" BGCOLOR="#FFFFFF" style="border-style: solid; border-width: 1px; border-color: #6E89AE;padding: 0px"><TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('3i.png'); border: 0px solid black;padding-left:12px; padding-right:0px; padding-top:1px; padding-bottom:1px;color:#FFFFFF;"><B><span style="font-size: 8pt; font-family: sans-serif;">Search on this site</span>
</B>
</TD>
</TR>
<TR><TD WIDTH="100%" VALIGN="MIDDLE" STYLE="background-image: url('2i.png'); border: 0px solid black; padding-left:6px; padding-right:0px; padding-top:4px; padding-bottom:4px;border-top: 1px solid #6E89AE;"><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%"><TR><TD><IMG SRC="4i.png" ALT="" BORDER="0"></TD>
<TD><FORM ACTION="https://www.google.com/search" METHOD="GET" STYLE="margin:0px;padding:0px;"><INPUT TYPE="HIDDEN" NAME="ie" VALUE="UTF-8"><INPUT TYPE="HIDDEN" NAME="oe" VALUE="UTF-8"><INPUT TYPE="TEXT" NAME="q" SIZE="15" MAXLENGTH="256" placeholder="Site search"><INPUT TYPE="HIDDEN" NAME="sitesearch" VALUE="ultimatepp.org"></FORM>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
<TABLE BORDER="0" WIDTH="100%"><TR><TD></TD>
</TR>
</TABLE>
<br><div id="fb-root"></div>
<script type="text/javascript">(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="fb-like" data-href="https://www.facebook.com/pages/Upp-Framework/262346610476027?sk=wall" data-send="false" data-layout="button_count" data-width="160" data-show-faces="false" data-font="arial"></div>
<br><br><script type="text/javascript"><!--
google_ad_client = "pub-1082147624384270";
google_ad_width = 160;
google_ad_height = 600;
google_ad_format = "160x600_as";
google_ad_type = "text_image";
google_ad_channel = "";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "008000";
//--></script>
<script type="text/javascript"
  src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script><br><br><script type="text/javascript"><!--
google_ad_client = "pub-1082147624384270";
google_ad_width = 160;
google_ad_height = 90;
google_ad_format = "160x90_0ads_al_s";
google_ad_channel = "";
google_color_border = "336699";
google_color_bg = "FFFFFF";
google_color_link = "0000FF";
google_color_text = "000000";
google_color_url = "008000";
//--></script>
<script type="text/javascript"
  src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
<br><br><br><br><br><br><A HREF="https://sourceforge.net/projects/upp/"><IMG SRC="https://sourceforge.net/sflogo.php?group_id=93970&amp;type=2" ALT="SourceForge.net Logo" BORDER="0" WIDTH="125" HEIGHT="37"></A>
<br><br><A HREF="https://flathub.org/en/apps/org.ultimatepp.TheIDE"><IMG SRC="5i.png" ALT="SourceForge.net Logo" BORDER="0" WIDTH="125" HEIGHT="37"></A>
<br><br><div style="background-color:#ffffff;width:125;height:35"><A HREF="https://github.com/ultimatepp"><IMG SRC="6i.png" ALT="GitHub Logo" BORDER="0" WIDTH="125" HEIGHT="35"></A>
</div><br><div style="background-color:#ffffff;width:125;height:35"><div style="height:5"></div><A HREF="https://discord.gg/8XzqQzXZzb"><IMG SRC="https://assets-global.website-files.com/6257adef93867e50d84d30e2/636e0b5061df29d55a92d945_full_logo_blurple_RGB.svg" ALT="Discord Logo" BORDER="0" WIDTH="125" HEIGHT="25"></A>
</div><br></TD>
</TR>
</TABLE>
</TD>
<TD VALIGN="TOP" BGCOLOR="#D2D9D2"><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="6"><TR><TD></TD>
</TR>
</TABLE>
</TD>
<TD VALIGN="TOP" WIDTH="100%" BGCOLOR="#D2D9D2"><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" BGCOLOR="#FFFFFF" WIDTH="100%" style="border-style: solid; border-width: 1px; border-color: #6E89AE;padding: 10px;;"><TR><TD><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%"><TR><TD><p class="C">SQLApp</p>
<p class="D">&nbsp;</p>
<p class="D">SQL application example</p>
<p class="D">&nbsp;</p>
<p class="E"><a href="examples$SQLApp$en-us.html_0.png"><img src="examples$SQLApp$en-us.html_0.png" border="0" alt="" style="width: 564px; height: 477px"></a></p>
<p class="A">&nbsp;</p>
<p class="A">&nbsp;</p>
<p class="F">SQLApp.h</p>
<p class="A">&nbsp;</p>
<p class="G"><span class="H">#ifndef</span> _SQLApp_SQLApp_h</p>
<p class="G"><span class="H">#define</span> _SQLApp_SQLApp_h</p>
<p class="G">&nbsp;</p>
<p class="I">#include<span class="J"> </span>&lt;<span class="J">SqlCtrl</span>/<span class="J">SqlCtrl</span>.<span class="J">h</span>&gt;</p>
<p class="I">#include<span class="J"> </span>&lt;<span class="J">plugin</span>/<span class="J">sqlite3</span>/<span class="J">Sqlite3</span>.<span class="J">h</span>&gt;</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">using</span> <span class="H">namespace</span> Upp;</p>
<p class="G">&nbsp;</p>
<p class="I">#define<span class="J"> LAYOUTFILE </span>&lt;<span class="J">SQLApp</span>/<span class="J">SQLApp</span>.<span class="J">lay</span>&gt;</p>
<p class="I">#include<span class="J"> </span>&lt;<span class="J">CtrlCore</span>/<span class="J">lay</span>.<span class="J">h</span>&gt;</p>
<p class="G">&nbsp;</p>
<p class="I">#define<span class="J"> SCHEMADIALECT </span>&lt;<span class="J">plugin</span>/<span class="J">sqlite3</span>/<span class="J">Sqlite3Schema</span>.<span class="J">h</span>&gt;</p>
<p class="I">#define<span class="J"> MODEL </span>&lt;<span class="J">SQLApp</span>/<span class="J">SQLApp</span>.<span class="J">sch</span>&gt;</p>
<p class="G"><span class="H">#include</span> &quot;Sql<span class="H">/</span>sch_header<span class="H">.</span>h&quot;</p>
<p class="G">&nbsp;</p>
<p class="G">Convert<span class="H">&amp;</span> DateIntConvert();</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">struct</span> SQLApp <span class="H">:</span> <span class="H">public</span> WithSQLAppLayout<span class="H">&lt;</span>TopWindow<span class="H">&gt;</span> {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;WithQueryLayout<span class="H">&lt;</span>TopWindow<span class="H">&gt;</span> query;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> Serialize(Stream<span class="H">&amp;</span> s);</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> Query(<span class="H">int</span> q);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> SetupQuery();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> ClearQuery();</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> NewBook();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> EditBook();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> DeleteBook();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> BookMenu(Bar<span class="H">&amp;</span> bar);</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> NewBorrow();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> EditBorrow();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> DeleteBorrow();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> ReturnedToday();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> BorrowMenu(Bar<span class="H">&amp;</span> bar);</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> SetupMenu(Bar<span class="H">&amp;</span> bar);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">void</span> MainMenu(Bar<span class="H">&amp;</span> bar);</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">typedef</span> SQLApp CLASSNAME;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQLApp();</p>
<p class="G">};</p>
<p class="G">&nbsp;</p>
<p class="I">#endif</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="F">borrow.cpp</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">#include</span> &quot;SQLApp<span class="H">.</span>h&quot;</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">struct</span> DateIntConvertCls <span class="H">:</span> Convert {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">virtual</span> Value Format(<span class="H">const</span> Value<span class="H">&amp;</span> q) <span class="H">const</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">virtual</span> Value Scan(<span class="H">const</span> Value<span class="H">&amp;</span> text) <span class="H">const</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">virtual</span> <span class="H">int</span> Filter(<span class="H">int</span> chr) <span class="H">const</span>;</p>
<p class="G">};</p>
<p class="G">&nbsp;</p>
<p class="I"><span class="J">Value DateIntConvertCls</span>::<span class="J">Format(</span>const<span class="J"> Value</span>&amp;<span class="J"> q) </span>const</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span> IsNull(q) <span class="H">?</span> String() <span class="H">:</span> <span class="H">::</span>Format(Date(1970, 1, 1) <span class="H">+</span> (<span class="H">int</span>)q);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="I"><span class="J">Value DateIntConvertCls</span>::<span class="J">Scan(</span>const<span class="J"> Value</span>&amp;<span class="J"> text) </span>const</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;String txt <span class="H">=</span> text;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(IsNull(txt))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span> Null;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;Date d;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(StrToDate(d, txt))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span> d <span class="H">-</span> Date(1970, 1, 1);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span> ErrorValue(&quot;Invalid date<span class="H">!</span>&quot;);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="I">int<span class="J"> DateIntConvertCls</span>::<span class="J">Filter(</span>int<span class="J"> chr) </span>const</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span> CharFilterDate(chr);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G">Convert<span class="H">&amp;</span> DateIntConvert()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span> Single<span class="H">&lt;</span>DateIntConvertCls<span class="H">&gt;</span>();</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">class</span> BorrowDlg <span class="H">:</span> <span class="H">public</span> WithBorrowLayout<span class="H">&lt;</span>TopWindow<span class="H">&gt;</span> {</p>
<p class="I">public:</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SqlCtrls ctrls;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">typedef</span> BorrowDlg CLASSNAME;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;BorrowDlg();</p>
<p class="G">};</p>
<p class="G">&nbsp;</p>
<p class="G">BorrowDlg<span class="H">::</span>BorrowDlg()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;CtrlLayoutOKCancel(<span class="H">*this</span>, &quot;Book borrow record&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ctrls</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(BORROWED, borrowed)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RETURNED, returned)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(PERSON, person)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>SetConvert(DateIntConvert());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed <span class="H">&lt;&lt;=</span> GetSysDate() <span class="H">-</span> Date(1970, 1, 1);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;returned<span class="H">.</span>SetConvert(DateIntConvert());</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>NewBorrow()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>book<span class="H">.</span>IsCursor())</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> Select(ID)<span class="H">.</span>From(BORROW_RECORD)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">.</span>Where(BOOK_ID <span class="H">==</span> book<span class="H">.</span>GetKey() <span class="H">&amp;&amp;</span> IsNull(RETURNED));</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(SQL<span class="H">.</span>Fetch() <span class="H">&amp;&amp;</span> <span class="H">!</span>PromptYesNo(&quot;The book is still borrowed<span class="H">!&amp;</span>Continue<span class="H">?</span>&quot;)) {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>FindSetCursor(SQL<span class="H">[</span>0<span class="H">]</span>);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;BorrowDlg dlg;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(dlg<span class="H">.</span>Run() <span class="H">!=</span> IDOK)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> dlg<span class="H">.</span>ctrls<span class="H">.</span>Insert(BORROW_RECORD)(BOOK_ID, book<span class="H">.</span>GetKey());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>FindSetCursor(SQL<span class="H">.</span>GetInsertedId());</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>EditBorrow()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>book<span class="H">.</span>IsCursor())</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">int</span> q <span class="H">=</span> borrowed<span class="H">.</span>GetKey();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;BorrowDlg dlg;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> Select(dlg<span class="H">.</span>ctrls)<span class="H">.</span>From(BORROW_RECORD)<span class="H">.</span>Where(ID <span class="H">==</span> q);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>dlg<span class="H">.</span>ctrls<span class="H">.</span>Fetch(SQL))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(dlg<span class="H">.</span>Run() <span class="H">!=</span> IDOK)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> dlg<span class="H">.</span>ctrls<span class="H">.</span>Update(BORROW_RECORD)<span class="H">.</span>Where(ID <span class="H">==</span> q);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>FindSetCursor(q);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>DeleteBorrow()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(book<span class="H">.</span>IsCursor() <span class="H">&amp;&amp;</span> PromptYesNo(&quot;Delete the borrow record<span class="H">?</span>&quot;)) {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> Delete(BORROW_RECORD)<span class="H">.</span>Where(ID <span class="H">==</span> book<span class="H">.</span>GetKey());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>ReturnedToday()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(borrowed<span class="H">.</span>IsCursor() <span class="H">&amp;&amp;</span> IsNull(borrowed<span class="H">.</span>Get(RETURNED)) <span class="H">&amp;&amp;</span> PromptYesNo(&quot;Mark as returned today<span class="H">?</span>&quot;)) {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">int</span> q <span class="H">=</span> borrowed<span class="H">.</span>GetKey();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> SqlUpdate(BORROW_RECORD)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RETURNED, GetSysDate() <span class="H">-</span> Date(1970, 1, 1))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">.</span>Where(ID <span class="H">==</span> q <span class="H">&amp;&amp;</span> IsNull(RETURNED));</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>FindSetCursor(q);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>BorrowMenu(Bar<span class="H">&amp;</span> bar)</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(book<span class="H">.</span>IsCursor(), &quot;New borrow record<span class="H">..</span>&quot;, THISBACK(NewBorrow))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="H">.</span>Key(K_ENTER);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(borrowed<span class="H">.</span>IsCursor(), &quot;Edit borrow record<span class="H">..</span>&quot;, THISBACK(EditBorrow));</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(borrowed<span class="H">.</span>IsCursor(), &quot;Delete borrow record&quot;, THISBACK(DeleteBorrow))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="H">.</span>Key(K_DELETE);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(borrowed<span class="H">.</span>IsCursor() <span class="H">&amp;&amp;</span> IsNull(borrowed<span class="H">.</span>Get(RETURNED)), &quot;Returned today&quot;,</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;THISBACK(ReturnedToday))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="H">.</span>Key(K_SPACE);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="F">book.cpp</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">#include</span> &quot;SQLApp<span class="H">.</span>h&quot;</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">struct</span> BookDlg <span class="H">:</span> <span class="H">public</span> WithBookLayout<span class="H">&lt;</span>TopWindow<span class="H">&gt;</span> {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SqlCtrls ctrls;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;BookDlg() {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CtrlLayoutOKCancel(<span class="H">*this</span>, &quot;Book&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrls</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(AUTHOR, author)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(TITLE, title)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p class="G">};</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>NewBook()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;BookDlg dlg;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(dlg<span class="H">.</span>Run() <span class="H">!=</span> IDOK)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> dlg<span class="H">.</span>ctrls<span class="H">.</span>Insert(BOOK);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;Query(SQL<span class="H">.</span>GetInsertedId());</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>EditBook()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>book<span class="H">.</span>IsCursor())</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;BookDlg dlg;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">int</span> q <span class="H">=</span> book<span class="H">.</span>GetKey();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> Select(dlg<span class="H">.</span>ctrls)<span class="H">.</span>From(BOOK)<span class="H">.</span>Where(ID <span class="H">==</span> q);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>dlg<span class="H">.</span>ctrls<span class="H">.</span>Fetch(SQL))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(dlg<span class="H">.</span>Run() <span class="H">!=</span> IDOK)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> dlg<span class="H">.</span>ctrls<span class="H">.</span>Update(BOOK)<span class="H">.</span>Where(ID <span class="H">==</span> q);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;Query(q);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>DeleteBook()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(book<span class="H">.</span>IsCursor() <span class="H">&amp;&amp;</span> PromptYesNo(&quot;Delete the book<span class="H">?</span>&quot;)) {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> Delete(BORROW_RECORD)<span class="H">.</span>Where(BOOK_ID <span class="H">==</span> book<span class="H">.</span>GetKey());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">*</span> Delete(BOOK)<span class="H">.</span>Where(ID <span class="H">==</span> book<span class="H">.</span>GetKey());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>BookMenu(Bar<span class="H">&amp;</span> bar)</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(&quot;New book<span class="H">..</span>&quot;, THISBACK(NewBook));</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(book<span class="H">.</span>IsCursor(), &quot;Edit book<span class="H">..</span>&quot;, THISBACK(EditBook));</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(book<span class="H">.</span>IsCursor(), &quot;Delete book<span class="H">..</span>&quot;, THISBACK(DeleteBook));</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Separator();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(&quot;Query<span class="H">..</span>&quot;, THISBACK(SetupQuery))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span class="H">.</span>Key(K_CTRL_F);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="F">query.cpp</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">#include</span> &quot;SQLApp<span class="H">.</span>h&quot;</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>Query()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SqlBool where;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SqlSet borrowed <span class="H">=</span> Select(BOOK_ID)<span class="H">.</span>From(BORROW_RECORD)<span class="H">.</span>Where(IsNull(RETURNED));</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(query<span class="H">.</span>status <span class="H">==</span> 1)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where <span class="H">=</span> ID <span class="H">!=</span> borrowed;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(query<span class="H">.</span>status <span class="H">==</span> 2)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where <span class="H">=</span> ID <span class="H">==</span> borrowed;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SqlBool bdate;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>IsNull(query<span class="H">.</span>borrowed_from))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bdate <span class="H">=</span> BORROWED <span class="H">&gt;=</span> <span class="H">~</span>query<span class="H">.</span>borrowed_from;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>IsNull(query<span class="H">.</span>borrowed_to))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bdate <span class="H">=</span> bdate <span class="H">&amp;&amp;</span> BORROWED <span class="H">&lt;=</span> <span class="H">~</span>query<span class="H">.</span>borrowed_to;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>bdate<span class="H">.</span>IsEmpty())</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;where <span class="H">=</span> where <span class="H">&amp;&amp;</span> ID <span class="H">==</span> Select(BOOK_ID)<span class="H">.</span>From(BORROW_RECORD)<span class="H">.</span>Where(bdate);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>Query(where);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>ClearQuery()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;query<span class="H">.</span>status <span class="H">=</span> 0;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;query<span class="H">.</span>borrowed_from <span class="H">&lt;&lt;=</span> query<span class="H">.</span>borrowed_to <span class="H">&lt;&lt;=</span> Null;</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>SetupQuery()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(query<span class="H">.</span>Execute() <span class="H">==</span> IDOK)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Query();</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>Query(<span class="H">int</span> q)</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(book<span class="H">.</span>FindSetCursor(q))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ClearQuery();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>FindSetCursor(q);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>Serialize(Stream<span class="H">&amp;</span> s)</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">int</span> version <span class="H">=</span> 0;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;s <span class="H">/</span> version;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;s <span class="H">%</span> query<span class="H">.</span>status</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="H">%</span> query<span class="H">.</span>borrowed_from</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span class="H">%</span> query<span class="H">.</span>borrowed_to;</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="F">main.cpp</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">#include</span> &quot;SQLApp<span class="H">.</span>h&quot;</p>
<p class="G">&nbsp;</p>
<p class="I">#define<span class="J"> SCHEMADIALECT </span>&lt;<span class="J">plugin</span>/<span class="J">sqlite3</span>/<span class="J">Sqlite3Schema</span>.<span class="J">h</span>&gt;</p>
<p class="G"><span class="H">#include</span> &quot;Sql<span class="H">/</span>sch_source<span class="H">.</span>h&quot;</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">void</span> SQLApp<span class="H">::</span>MainMenu(Bar<span class="H">&amp;</span> bar)</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(&quot;Book&quot;, THISBACK(BookMenu));</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(&quot;Borrow record&quot;, THISBACK(BorrowMenu));</p>
<p class="G"><span class="H">#ifdef</span> _DEBUG</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;bar<span class="H">.</span>Add(&quot;SQL console&quot;, callback(SQLCommander));</p>
<p class="I">#endif</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G">SQLApp<span class="H">::</span>SQLApp()</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;CtrlLayout(<span class="H">*this</span>, &quot;Window title&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;menu<span class="H">.</span>Set(THISBACK(MainMenu));</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>SetTable(BOOK);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>AddKey(ID);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>AddColumn(AUTHOR, &quot;Author&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>AddColumn(TITLE, &quot;Title&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>SetOrderBy(TITLE, AUTHOR);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>WhenBar <span class="H">=</span> THISBACK(BookMenu);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;book<span class="H">.</span>WhenLeftDouble <span class="H">=</span> THISBACK(EditBook);</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>SetTable(BORROW_RECORD);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>AddKey(ID);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>Join(BOOK_ID, book);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>AddColumn(BORROWED, &quot;Borrowed&quot;)<span class="H">.</span>SetConvert(DateIntConvert());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>AddColumn(RETURNED, &quot;Returned&quot;)<span class="H">.</span>SetConvert(DateIntConvert());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>AddColumn(PERSON, &quot;Who borrowed&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>ColumnWidths(&quot;75 75 372&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>SetOrderBy(BORROWED);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>WhenBar <span class="H">=</span> THISBACK(BorrowMenu);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>WhenLeftDouble <span class="H">=</span> THISBACK(EditBorrow);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;borrowed<span class="H">.</span>GoEndPostQuery();</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;CtrlLayoutOKCancel(query, &quot;Select&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;query<span class="H">.</span>status <span class="H">=</span> 0;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;query<span class="H">.</span>borrowed_from<span class="H">.</span>SetConvert(DateIntConvert());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;query<span class="H">.</span>borrowed_to<span class="H">.</span>SetConvert(DateIntConvert());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;query<span class="H">.</span>clear <span class="H">&lt;&lt;=</span> THISBACK(ClearQuery);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">#ifdef</span> _DEBUG</p>
<p class="I">#define<span class="J"> SCHEMADIALECT </span>&lt;<span class="J">plugin</span>/<span class="J">sqlite3</span>/<span class="J">Sqlite3Schema</span>.<span class="J">h</span>&gt;</p>
<p class="G"><span class="H">#include</span> &quot;Sql<span class="H">/</span>sch_schema<span class="H">.</span>h&quot;</p>
<p class="I">#endif</p>
<p class="G">&nbsp;</p>
<p class="G">GUI_APP_MAIN</p>
<p class="G">{</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;Sqlite3Session sqlite3;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(<span class="H">!</span>sqlite3<span class="H">.</span>Open(ConfigFile(&quot;simple<span class="H">.</span>db&quot;))) {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exclamation(&quot;Can't create <span class="H">or</span> open database file\n&quot;);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">return</span>;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQL <span class="H">=</span> sqlite3;</p>
<p class="G">&nbsp;</p>
<p class="G"><span class="H">#ifdef</span> _DEBUG</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SqlSchema sch(SQLITE3);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;sqlite3<span class="H">.</span>SetTrace();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;All_Tables(sch);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(sch<span class="H">.</span>ScriptChanged(SqlSchema<span class="H">::</span>UPGRADE))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sqlite3PerformScript(sch<span class="H">.</span>Upgrade());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(sch<span class="H">.</span>ScriptChanged(SqlSchema<span class="H">::</span>ATTRIBUTES))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sqlite3PerformScript(sch<span class="H">.</span>Attributes());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;<span class="H">if</span>(sch<span class="H">.</span>ScriptChanged(SqlSchema<span class="H">::</span>CONFIG)) {</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sqlite3PerformScript(sch<span class="H">.</span>ConfigDrop());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sqlite3PerformScript(sch<span class="H">.</span>Config());</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;sch<span class="H">.</span>SaveNormal();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;sqlite3<span class="H">.</span>SetTrace();</p>
<p class="I">#endif</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;SQLApp app;</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;LoadFromFile(app);</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;app<span class="H">.</span>Query();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;app<span class="H">.</span>Run();</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;StoreToFile(app);</p>
<p class="G">}</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="F">SQLApp.lay</p>
<p class="G">&nbsp;</p>
<p class="G">LAYOUT(SQLAppLayout, 548, 440)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(SqlArray, book, LeftPosZ(4, 536)<span class="H">.</span>TopPosZ(28, 200))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(SqlArray, borrowed, LeftPosZ(4, 536)<span class="H">.</span>TopPosZ(232, 204))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(MenuBar, menu, LeftPosZ(4, 304)<span class="H">.</span>TopPosZ(4, 20))</p>
<p class="G">END_LAYOUT</p>
<p class="G">&nbsp;</p>
<p class="G">LAYOUT(BookLayout, 340, 88)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Label, dv___0, SetLabel(t_(&quot;Author&quot;))<span class="H">.</span>LeftPosZ(4, 40)<span class="H">.</span>TopPosZ(4, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(EditString, author, LeftPosZ(48, 284)<span class="H">.</span>TopPosZ(4, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Label, dv___2, SetLabel(t_(&quot;Title&quot;))<span class="H">.</span>LeftPosZ(4, 40)<span class="H">.</span>TopPosZ(28, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(EditString, title, LeftPosZ(48, 284)<span class="H">.</span>TopPosZ(28, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Button, ok, SetLabel(t_(&quot;OK&quot;))<span class="H">.</span>LeftPosZ(200, 64)<span class="H">.</span>TopPosZ(56, 24))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Button, cancel, SetLabel(t_(&quot;Cancel&quot;))<span class="H">.</span>LeftPosZ(268, 64)<span class="H">.</span>TopPosZ(56, 24))</p>
<p class="G">END_LAYOUT</p>
<p class="G">&nbsp;</p>
<p class="G">LAYOUT(BorrowLayout, 280, 88)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Label, dv___0, SetLabel(t_(&quot;Borrowed&quot;))<span class="H">.</span>LeftPosZ(4, 56)<span class="H">.</span>TopPosZ(4, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(EditField, borrowed, LeftPosZ(60, 72)<span class="H">.</span>TopPosZ(4, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Label, dv___2, SetLabel(t_(&quot;Returned&quot;))<span class="H">.</span>LeftPosZ(140, 56)<span class="H">.</span>TopPosZ(4, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(EditField, returned, LeftPosZ(196, 76)<span class="H">.</span>TopPosZ(4, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Label, dv___4, SetLabel(t_(&quot;Person&quot;))<span class="H">.</span>LeftPosZ(4, 56)<span class="H">.</span>TopPosZ(28, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(EditString, person, LeftPosZ(60, 212)<span class="H">.</span>TopPosZ(28, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Button, ok, SetLabel(t_(&quot;OK&quot;))<span class="H">.</span>LeftPosZ(140, 64)<span class="H">.</span>TopPosZ(56, 24))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Button, cancel, SetLabel(t_(&quot;Cancel&quot;))<span class="H">.</span>LeftPosZ(208, 64)<span class="H">.</span>TopPosZ(56, 24))</p>
<p class="G">END_LAYOUT</p>
<p class="G">&nbsp;</p>
<p class="G">LAYOUT(QueryLayout, 292, 112)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(LabelBox, dv___0, SetLabel(t_(&quot;Status&quot;))<span class="H">.</span>LeftPosZ(8, 276)<span class="H">.</span>TopPosZ(8, 36))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Switch, status, SetLabel(t_(&quot;Does <span class="H">not</span> matter\nIn library\nBorrowed&quot;))<span class="H">.</span>LeftPosZ(16, 256)<span class="H">.</span>TopPosZ(24, 16))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Label, dv___2, SetLabel(t_(&quot;Borrow date between&quot;))<span class="H">.</span>LeftPosZ(8, 108)<span class="H">.</span>TopPosZ(52, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(EditDate, borrowed_from, LeftPosZ(116, 72)<span class="H">.</span>TopPosZ(52, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Label, dv___4, SetLabel(t_(&quot;<span class="H">and</span>&quot;))<span class="H">.</span>LeftPosZ(192, 20)<span class="H">.</span>TopPosZ(52, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(EditDate, borrowed_to, LeftPosZ(212, 72)<span class="H">.</span>TopPosZ(52, 19))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Button, clear, SetLabel(t_(&quot;Clear&quot;))<span class="H">.</span>LeftPosZ(8, 64)<span class="H">.</span>TopPosZ(80, 24))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Button, ok, SetLabel(t_(&quot;OK&quot;))<span class="H">.</span>LeftPosZ(152, 64)<span class="H">.</span>TopPosZ(80, 24))</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;ITEM(Button, cancel, SetLabel(t_(&quot;Cancel&quot;))<span class="H">.</span>LeftPosZ(220, 64)<span class="H">.</span>TopPosZ(80, 24))</p>
<p class="G">END_LAYOUT</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="F">SQLApp.sch</p>
<p class="G">&nbsp;</p>
<p class="G">TABLE_(BOOK)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;INT_ &nbsp;&nbsp;&nbsp;(ID) PRIMARY_KEY AUTO_INCREMENT</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;STRING_ (AUTHOR, 2000)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;STRING_ (TITLE, 2000)</p>
<p class="G">END_TABLE</p>
<p class="G">&nbsp;</p>
<p class="G">TABLE_(BORROW_RECORD)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;INT &nbsp;&nbsp;&nbsp;&nbsp;(ID) PRIMARY_KEY AUTO_INCREMENT</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;INT_ &nbsp;&nbsp;&nbsp;(BOOK_ID) REFERENCES(BOOK)</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;STRING_ (PERSON, 2000) INDEX</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;INT_ &nbsp;&nbsp;&nbsp;(BORROWED) INDEX</p>
<p class="G">&nbsp;&nbsp;&nbsp;&nbsp;INT_ &nbsp;&nbsp;&nbsp;(RETURNED) INDEX</p>
<p class="G">END_TABLE</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
<p class="G">&nbsp;</p>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
<TABLE BORDER="0" WIDTH="100%"><TR><TD></TD>
</TR>
</TABLE>
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" BGCOLOR="#FFFFFF" WIDTH="100%" style="border-style: solid; border-width: 1px; border-color: #6E89AE;padding: 10px;;"><TR><TD><TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0" WIDTH="100%"><TR><TD><p class="A"><span class="B"> </span><a href="www$uppweb$contribweb$en-us.html">Do you want to contribute?</a></p>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
</TD>
</TR>
</TABLE>
<script type="text/javascript">var a={'examples$SQLApp$en-us.html':'English'};var p=window.location.pathname.split("/");p=p[p.length-1];var s='<select id="lang" onchange="window.location=document.getElementById(\'lang\').value;">';for(l in a){if(p==l){d=" selected=1"}else{d=""}s+='<option value="'+l+'"'+d+'>'+a[l]+'</option>'}s+='</select>';var d=document.createElement('div');d.innerHTML=s;var c=document.getElementById('langs');c.replaceChild(d,c.firstChild);document.getElementById('langbox').style.display='block';</script></BODY>
